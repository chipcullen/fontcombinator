<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Font Combinator!</title>
</head>
<body>
<h1>The Font Combinator!</h1>
<h2>Stuff will go here</h2>
<font-list></font-list>

</body>
<script defer type="module">

const SUBSET = 'latin';
const PUBLIC_API_KEY = 'AIzaSyAc3a2WfPaSbA1B25u78zFQRfAide8T34c';
const TOP_NUMBER_OF_FONTS = 100;

// Google Fonts API documentation: https://developers.google.com/fonts/docs/developer_api
// category: serif | sans-serif | monospace | display | handwriting
// capability: VF | WOFF2
// sort: alpha | date | popularity | style | trending
const getGoogleFonts = async (sort = 'alpha', capability = 'VF', category) => {
  const url = new URL('https://www.googleapis.com/webfonts/v1/webfonts');
  url.searchParams.append('key', PUBLIC_API_KEY);
  url.searchParams.append('sort', sort);
  url.searchParams.append('capability', capability);
  url.searchParams.append('subset', SUBSET);
  if (category) {
    url.searchParams.append('category', category);
  }

  const response = await fetch(url);
  const data = await response.json();
  return data.items;
};

const allFonts = await getGoogleFonts('popularity');
console.log({allFonts});

const variableFonts = allFonts.filter((font) => {
  return font.axes !== undefined;
});

console.log({ variableFonts });

const topNumberOfVariableFonts = variableFonts.slice(0, TOP_NUMBER_OF_FONTS);

const fontListTemplate = document.createElement("template");

fontListTemplate.innerHTML = `
<style>
  select {
  &, &::picker(select) {
    appearance: base-select;
    font-family: sans-serif;
    max-width: 100vw;
  }
  option {
    outline: 1px solid grey;
    margin: 10px;
    text-wrap: wrap;
    max-width: 100vw;
    border-radius: 5px;

    &:focus, &:hover {
      outline-width: 3px;
      background-color: LightCyan;
    }
  }
}
</style>
<div class="font-list">
  <select></select>
</div>
`
class FontList extends HTMLElement {
  constructor() {
    super();
    const shadow = this.attachShadow({ mode: "open" });
    shadow.append(fontListTemplate.content.cloneNode(true));
    this.select = shadow.querySelector("select");
  }


  async connectedCallback() {
    topNumberOfVariableFonts.forEach((font, index) => {
      const { family, variants, subsets } = font;
      const slug = family.replace(" ", "+");
      const option = document.createElement("option");
      option.value = slug;
      option.innerText = family;

      this.select.appendChild(option);
    });

    this.select.addEventListener("change", (e) => {
      console.log('changed')
    });
  }
}

customElements.define("font-list", FontList);
</script>
</html>
